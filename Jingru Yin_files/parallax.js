define("text",["module"],function(t){"use strict";function a(t,a){return void 0===t||""===t?a:t}function e(t,e,s,i){if(e===i)return!0;if(t===s){if("http"===t)return a(e,"80")===a(i,"80");if("https"===t)return a(e,"443")===a(i,"443")}return!1}var s,i,r,o,d,h=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,u="undefined"!=typeof location&&location.href,c=u&&location.protocol&&location.protocol.replace(/\:/,""),_=u&&location.hostname,m=u&&(location.port||void 0),p={},g=t.config&&t.config()||{};return s={version:"2.0.16",strip:function(t){if(t){t=t.replace(n,"");var a=t.match(l);a&&(t=a[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:g.createXhr||function(){var t,a,e;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(a=0;a<3;a+=1){e=h[a];try{t=new ActiveXObject(e)}catch(t){}if(t){h=[e];break}}return t},parseName:function(t){var a,e,s,i=!1,r=t.lastIndexOf("."),o=0===t.indexOf("./")||0===t.indexOf("../");return-1!==r&&(!o||r>1)?(a=t.substring(0,r),e=t.substring(r+1)):a=t,s=e||a,r=s.indexOf("!"),-1!==r&&(i="strip"===s.substring(r+1),s=s.substring(0,r),e?e=s:a=s),{moduleName:a,ext:e,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,a,i,r){var o,d,h,n=s.xdRegExp.exec(t);return!n||(o=n[2],d=n[3],d=d.split(":"),h=d[1],d=d[0],(!o||o===a)&&(!d||d.toLowerCase()===i.toLowerCase())&&(!h&&!d||e(o,h,a,r)))},finishLoad:function(t,a,e,i){e=a?s.strip(e):e,g.isBuild&&(p[t]=e),i(e)},load:function(t,a,e,i){if(i&&i.isBuild&&!i.inlineText)return void e();g.isBuild=i&&i.isBuild;var r=s.parseName(t),o=r.moduleName+(r.ext?"."+r.ext:""),d=a.toUrl(o),h=g.useXhr||s.useXhr;if(0===d.indexOf("empty:"))return void e();!u||h(d,c,_,m)?s.get(d,function(a){s.finishLoad(t,r.strip,a,e)},function(t){e.error&&e.error(t)}):a([o],function(t){s.finishLoad(r.moduleName+"."+r.ext,r.strip,t,e)},function(t){e.error&&e.error(t)})},write:function(t,a,e,i){if(p.hasOwnProperty(a)){var r=s.jsEscape(p[a]);e.asModule(t+"!"+a,"define(function () { return '"+r+"';});\n")}},writeFile:function(t,a,e,i,r){var o=s.parseName(a),d=o.ext?"."+o.ext:"",h=o.moduleName+d,n=e.toUrl(o.moduleName+d)+".js";s.load(h,e,function(a){var e=function(t){return i(n,t)};e.asModule=function(t,a){return i.asModule(t,n,a)},s.write(t,h,e,r)},r)}},"node"===g.env||!g.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(i=require.nodeRequire("fs"),s.get=function(t,a,e){try{var s=i.readFileSync(t,"utf8");"\ufeff"===s[0]&&(s=s.substring(1)),a(s)}catch(t){e&&e(t)}}):"xhr"===g.env||!g.env&&s.createXhr()?s.get=function(t,a,e,i){var r,o=s.createXhr();if(o.open("GET",t,!0),i)for(r in i)i.hasOwnProperty(r)&&o.setRequestHeader(r.toLowerCase(),i[r]);g.onXhr&&g.onXhr(o,t),o.onreadystatechange=function(s){var i,r;4===o.readyState&&(i=o.status||0,i>399&&i<600?(r=new Error(t+" HTTP status: "+i),r.xhr=o,e&&e(r)):a(o.responseText),g.onXhrComplete&&g.onXhrComplete(o,t))},o.send(null)}:"rhino"===g.env||!g.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?s.get=function(t,a){var e,s,i=new java.io.File(t),r=java.lang.System.getProperty("line.separator"),o=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),"utf-8")),d="";try{for(e=new java.lang.StringBuffer,s=o.readLine(),s&&s.length()&&65279===s.charAt(0)&&(s=s.substring(1)),null!==s&&e.append(s);null!==(s=o.readLine());)e.append(r),e.append(s);d=String(e.toString())}finally{o.close()}a(d)}:("xpconnect"===g.env||!g.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(r=Components.classes,o=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),d="@mozilla.org/windows-registry-key;1"in r,s.get=function(t,a){var e,s,i,h={};d&&(t=t.replace(/\//g,"\\")),i=new FileUtils.File(t);try{e=r["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),e.init(i,1,0,!1),s=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),s.init(e,"utf-8",e.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(e.available(),h),s.close(),e.close(),a(h.value)}catch(t){throw new Error((i&&i.path||"")+": "+t)}}),s}),define("text!parallax/template.html",[],function(){return'<canvas class="parallax_canvas"></canvas>'}),define("global_libs/require/normalize",[],function(){function t(t,s,i){if(t.match(d)||t.match(o))return t;t=r(t);var h=i.match(o),n=s.match(o);return!n||h&&h[1]==n[1]&&h[2]==n[2]?e(a(t,s),i):a(t,s)}function a(t,a){if("./"==t.substr(0,2)&&(t=t.substr(2)),t.match(d)||t.match(o))return t;var e=a.split("/"),s=t.split("/");for(e.pop();curPart=s.shift();)".."==curPart?e.pop():e.push(curPart);return e.join("/")}function e(t,a){var e=a.split("/");for(e.pop(),a=e.join("/")+"/",i=0;a.substr(i,1)==t.substr(i,1);)i++;for(;"/"!=a.substr(i,1);)i--;a=a.substr(i+1),t=t.substr(i+1),e=a.split("/");var s=t.split("/");for(out="";e.shift();)out+="../";for(;curPart=s.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var s=/([^:])\/+/g,r=function(t){return t.replace(s,"$1/")},o=/[^\:\/]*:\/\/([^\/])*/,d=/^(\/|data:)/,h=function(a,e,s){e=r(e),s=r(s);for(var i,o,a,d=/@import\s*("([^"]*)"|'([^']*)')|url\s*\((?!#)\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;i=d.exec(a);){o=i[3]||i[2]||i[5]||i[6]||i[4];var h;h=t(o,e,s);var n=i[5]||i[6]?1:0;a=a.substr(0,d.lastIndex-o.length-n-1)+h+a.substr(d.lastIndex-n-1),d.lastIndex=d.lastIndex+(h.length-o.length)}return a};return h.convertURIBase=t,h.absoluteURI=a,h.relativeURI=e,h}),define("css",[],function(){if("undefined"==typeof window)return{load:function(t,a,e){e()}};var t=document.getElementsByTagName("head")[0],a=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,e=!1,s=!0;a[1]||a[7]?e=parseInt(a[1])<6||parseInt(a[7])<=9:a[2]||a[8]?s=!1:a[4]&&(e=parseInt(a[4])<18);var i={};i.pluginBuilder="global_libs/require/css-builder";var r,o,d,h=function(){r=document.createElement("style"),t.appendChild(r),o=r.styleSheet||r.sheet},n=0,l=[],u=function(t){n++,32==n&&(h(),n=0),o.addImport(t),r.onload=function(){c()}},c=function(){d();var t=l.shift();return t?(d=t[1],void u(t[0])):void(d=null)},_=function(t,a){if(o&&o.addImport||h(),o&&o.addImport)d?l.push([t,a]):(u(t),d=a);else{r.textContent='@import "'+t+'";';var e=setInterval(function(){try{r.sheet.cssRules,clearInterval(e),a()}catch(t){}},10)}},m=function(a,e){var i=document.createElement("link");if(i.type="text/css",i.rel="stylesheet",s)i.onload=function(){i.onload=function(){},setTimeout(e,7)};else var r=setInterval(function(){for(var t=0;t<document.styleSheets.length;t++){if(document.styleSheets[t].href==i.href)return clearInterval(r),e()}},10);i.href=a,t.appendChild(i)};return i.normalize=function(t,a){return".css"==t.substr(t.length-4,4)&&(t=t.substr(0,t.length-4)),a(t)},i.load=function(t,a,s){(e?_:m)(a.toUrl(t+".css"),s)},i}),define("css!parallax/style",[],function(){}),requirejs.config({shim:{pixi:{exports:"PIXI"},stackblur:{exports:"stackBlur",init:function(){return{stackBlurImage:stackBlurImage,stackBlurCanvasRGBA:stackBlurCanvasRGBA,stackBlurCanvasRGB:stackBlurCanvasRGB,stackBlurCanvasOnlyAlpha:stackBlurCanvasOnlyAlpha,BlurStack:BlurStack}}}},paths:{pixi:"_libs/pixi5.min",stackblur:"_libs/stackblur"}}),define("parallax/main",["text!parallax/template.html","pixi","stackblur","css!./style"],function(t,a,e){return Backbone.View.extend({template:_.template(t),deferredLoadEventName:"parallax-load-complete",defaults:{see_through:!1,image_url:"//static.cargo.site/assets/backdrop/default_1024.jpg",image_size:1024,image:"",knockout_shape:"triangle",knockout_blur:0,knockout:85,knockout_rotation:171,movement_direction:"xy",xy_direction:285,layers:3,z_layers:4,speed:30,depth:35,base_rotation:50,skew:-50,mouse_interaction:!0,mouse_speed:68,scroll_interaction:!1,color:"rgba(51,51,51,0)",overlay_hex:"#ffffff",overlay_alpha:0,hex_color:"#333333",color_r:"51",color_g:"51",color_b:"51",alpha:"0",plugin_id:16,z_direction:"outwards"},drawFrameID:null,initialize:function(){this.draw=_.bind(this.draw,this),this.Init=_.bind(this.Init,this),this.SetSizeFromMainView=_.bind(this.SetSizeFromMainView,this),this.updateScrollOffset=this.updateScrollOffset.bind(this),this.updateMouseOffset=this.updateMouseOffset.bind(this),this.image_load_queue=[];var t=Object.assign({},this.model.get("data"));_.defaults(t,this.defaults),this.model.set("data",t),this.listenTo(this.model,"reset",this.Init)},render:function(){var t=Cargo.Core.Handlebars.Render("{{>loading_animation}}",{});return t+=this.template({settings:this.model.toJSON()}),this.$el.html(t),this},loadImage:function(){$(".loading_animation",this.el).removeClass("hidden");var t=this.model.get("data"),e=this,s=Cargo.Collection.Images.fetchImage(t.image,this.defaults.image_size);s?s.id=t.image:(s={w:1500,h:1500,url:this.defaults.image_url,id:0},t.image=0,this.model.set("data",t));var i=new Image;i.crossOrigin="",this.data.image_loaded=!1,this.image_load_queue.push(s.id),i.onload=function(){if(!0!==e.destroyed){var t=e.image_load_queue.pop();if(e.model.get("data").image!=t)return void e.loadImage();t==s.id&&(e.image_load_queue=[],e.data.texture=new a.Texture.from(i.src),requestAnimationFrame(function(){if(e.data.image_loaded=!0,e.makeMask(),e.data.sprites.length>0)for(var t=0;t<e.data.layers;t++)e.data.sprites[t].renderable=!0;e.data.inited=!0,e.in_viewport?e.Resume():e.Pause(),setTimeout(function(){$(".loading_animation",e.el).addClass("hidden"),Cargo.Event.trigger(e.deferredLoadEventName)},100)}))}},i.src=s.url,this.image_object=i},makeMask:function(){if(1!=this.destroyed){var t=this.model.get("data"),s=this,i=100-t.knockout;if(!this.data.texture.baseTexture.valid||0==this.data.image_loaded)return void(this.data.mask_attempts<100&&(this.data.mask_attempts++,setTimeout(function(){s.makeMask()},150)));if(0==!this.data.texture.baseTexture.valid&&100==i)return this.setTexture(),void this.setLayerData();this.data.mask_attempts=0,this.canvas||(this.canvas=document.createElement("canvas")),this.canvas.width=this.data.texture.width,this.canvas.height=this.data.texture.height;var r=this.canvas.getContext("2d"),o=t.knockout_shape,d=t.knockout_blur/3,h=t.knockout_rotation*(Math.PI/180),n=Math.cos(h),l=Math.sin(h),u=n,c=l,_=-l,m=n,p=.5*this.data.texture.width,g=.5*this.data.texture.height,f=p*n-g*l,x=p*l+g*n,v=i/200*this.data.texture.width,y=i/200*this.data.texture.height,b=0,w=0,z=0,k=0,M=p-f,I=g-x;z=.067*(.5*this.data.texture.height-(w+y)),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.globalCompositeOperation="source-over",r.transform(u,c,_,m,M,I),r.beginPath(),r.fillStyle="black","rectangle"==o?(r.moveTo(v,y),r.lineTo(this.data.texture.width-v,y),r.lineTo(this.data.texture.width-v,this.data.texture.height-y),r.lineTo(v,this.data.texture.height-y)):"square"==o?(this.data.texture.width>this.data.texture.height?(v=y,b=(this.data.texture.width-this.data.texture.height)/2):(y=v,w=(this.data.texture.height-this.data.texture.width)/2),r.moveTo(v+b,y+w),r.lineTo(this.data.texture.width-(v+b),y+w),r.lineTo(this.data.texture.width-(v+b),this.data.texture.height-(y+w)),r.lineTo(v+b,this.data.texture.height-(y+w))):"triangle"==o?(this.data.texture.width>this.data.texture.height?(v=y,b=(this.data.texture.width-this.data.texture.height)/2):(y=v,w=(this.data.texture.height-this.data.texture.width)/2),r.moveTo(this.data.texture.width/2,y+w+z),r.lineTo(this.data.texture.width-(v+b),this.data.texture.height-(y+w+z)),r.lineTo(v+b,this.data.texture.height-(y+w+z))):"circle"==o&&(this.data.texture.width>this.data.texture.height?(v=y,k=this.data.texture.width/2-(this.data.texture.width-this.data.texture.height)/2-v):(y=v,k=this.data.texture.height/2-(this.data.texture.height-this.data.texture.width)/2-y),r.arc(this.data.texture.width/2,this.data.texture.height/2,k,0,2*Math.PI)),r.closePath(),r.fill(),r.setTransform(1,0,0,1,0,0),e.stackBlurCanvasOnlyAlpha(this.canvas,0,0,this.data.texture.width,this.data.texture.height,d),r.globalCompositeOperation="source-out",r.drawImage(this.image_object,0,0,this.canvas.width,this.canvas.height),null==this.data.masked_image_texture?this.data.masked_image_texture=new a.Texture.from(this.canvas):this.data.masked_image_texture.update(),this.setTexture(),this.setLayerData()}},setTexture:function(){for(var t=this.model.get("data").knockout,a=0;a<this.data.layers;a++)0==t?this.data.sprites[a].texture=this.data.texture:"CANVAS"===this.data.sprites[a].texture.baseTexture.resource.nodeName?this.data.sprites[a].texture.update():this.data.sprites[a].texture=this.data.masked_image_texture;this.model.get("data").see_through?this.data.bg_sprite.texture=this.data.masked_image_texture:this.data.bg_sprite.texture=this.data.texture},makeSprites:function(){var t=this.model.get("data").knockout;this.data.color_sprite=null,this.data.bg_sprite=null,this.data.filters=[],this.data.overlay_sprite=null,this.data.color_sprite=new a.Sprite(a.Texture.WHITE,this.data.stage_size.w,this.data.stage_size.h),this.model.get("data").see_through?(this.data.bg_sprite=new a.TilingSprite(this.data.masked_image_texture||a.Texture.WHITE,this.data.stage_size.w,this.data.stage_size.h),this.data.bg_sprite.filters=[new a.filters.ColorMatrixFilter]):(this.data.bg_sprite=null,this.data.bg_sprite=new a.TilingSprite(this.data.texture||a.Texture.WHITE,this.data.stage_size.w,this.data.stage_size.h)),this.data.stage.addChild(this.data.color_sprite),this.data.bg_sprite.anchor={x:.5,y:.5},this.data.bg_sprite.pivot={x:.5,y:.5},this.data.stage.addChild(this.data.bg_sprite);for(var e=0;e<this.data.layers;e++)this.data.sprites[e]=t>0?new a.TilingSprite(this.data.masked_image_texture||a.Texture.WHITE,this.data.stage_size.w,this.data.stage_size.h):new a.TilingSprite(this.data.texture||a.Texture.WHITE,this.data.stage_size.w,this.data.stage_size.h),this.data.sprites[e].anchor={x:.5,y:.5},this.data.sprites[e].pivot={x:.5,y:.5},null!==this.data.texture?this.data.sprites[e].renderable=!0:this.data.sprites[e].renderable=!1,this.data.filters[e]=new a.filters.ColorMatrixFilter,this.data.sprites[e].filters=[this.data.filters[e]],this.data.stage.addChild(this.data.sprites[e]);this.data.overlay_sprite=new a.Sprite.from("_jsapps/backdrop/parallax/assets/blank.png"),this.data.overlay_sprite.width=this.data.stage_size.w,this.data.overlay_sprite.height=this.data.stage_size.h,this.data.stage.addChild(this.data.overlay_sprite),this.changeBGColor(),this.changeOverlayColor()},setLayerData:function(){this.data.overlay_sprite.width=this.data.stage_size.w,this.data.overlay_sprite.height=this.data.stage_size.h,this.data.color_sprite.width=this.data.stage_size.w,this.data.color_sprite.height=this.data.stage_size.h;var t=this.model.get("data");if(null!==this.data.texture){this.data.direction=t.movement_direction,"xy"==this.data.direction?(this.data.depth=t.depth/80,this.data.layers=t.layers-1):(this.data.depth=t.depth/15,this.data.layers=t.z_layers-1),this.data.rotation=t.skew*(Math.PI/180),this.data.base_rotation=t.base_rotation*(Math.PI/180),this.data.alpha=t.alpha,this.data.box_size=0;var a=1/Math.pow((this.data.layers-(this.data.layers-4))/this.data.layers*this.data.depth+1,2)/(1/Math.pow((this.data.layers-this.data.layers)/this.data.layers*this.data.depth+1,2));this.data.stage_size.w>this.data.stage_size.h?this.data.box_size=1.475*this.data.stage_size.w:this.data.box_size=1.475*this.data.stage_size.h;var e=this.data.texture.width/this.data.texture.height,s=this.data.stage_size.w/this.data.stage_size.h;this.data.multiplier=e>s?this.data.stage_size.h/this.data.texture.height*1.475+this.data.stage_size.h/this.data.texture.height*(1-a)*4:this.data.stage_size.w/this.data.texture.width*1.475+this.data.stage_size.w/this.data.texture.width*(1-a)*4,this.data.color_rgba.r=t.color_r/255,this.data.color_rgba.g=t.color_g/255,this.data.color_rgba.b=t.color_b/255,this.data.color_rgba.a=t.alpha}},styleLayers:function(){if(null!==this.data.texture){this.data.bg_sprite.alpha=1-this.data.alpha,1==this.data.alpha||this.model.get("data").see_through?this.data.bg_sprite.renderable=!1:this.data.bg_sprite.renderable=!0;var t=Math.sqrt(1/(this.data.layers-1));"xy"==this.data.direction?(this.data.z_offset=1,this.data.z_offset_exp=1):(this.data.z_offset=(this.data.movement_offset.y+this.data.mouse_delta.smooth_cumu_y)*(1/this.data.stage_size.h)%1,this.data.z_offset<=0&&(this.data.z_offset+=1),this.data.z_offset_exp=Math.pow(this.data.z_offset,2)*t+this.data.z_offset*(1-t));for(var a=0;a<this.data.layers;a++){var e=(this.data.layers-(a+1))/this.data.layers,s=(e+1/this.data.layers)*(1-this.data.z_offset)+e*this.data.z_offset,i=Math.pow(s,2),r=(this.data.layers-(a+1))/this.data.layers*this.data.depth,o=1,d=1;this.data.depth>0&&(o=1/Math.pow(r+1,2),o*=this.data.multiple,d=1/Math.pow((this.data.layers-a)/this.data.layers*this.data.depth+1,2)/(1/Math.pow((this.data.layers-(a+1))/this.data.layers*this.data.depth+1,2)));var h=(this.data.z_offset,this.data.z_offset,[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);if(h[0]=1-i*this.data.color_rgba.a,h[3]=i*this.data.color_rgba.r*this.data.color_rgba.a,h[6]=1-i*this.data.color_rgba.a,h[8]=i*this.data.color_rgba.g*this.data.color_rgba.a,h[12]=1-i*this.data.color_rgba.a,h[13]=i*this.data.color_rgba.b*this.data.color_rgba.a,"z"==this.data.direction&&(a+1==this.data.layers&&(h[0]=h[0]-this.data.z_offset,h[6]=h[6]-this.data.z_offset,h[12]=h[12]-this.data.z_offset,h[18]=h[18]-this.data.z_offset),0==a&&(h[0]=1*(1-this.data.alpha)+this.data.alpha*Math.min(this.data.z_offset*(1-this.data.color_rgba.a)+this.data.color_rgba.a*h[0],h[0]),h[3]=this.data.alpha*Math.max((1-this.data.z_offset)*this.data.color_rgba.r*(1-this.data.color_rgba.a)+this.data.color_rgba.a*h[3],h[3]),h[6]=1*(1-this.data.alpha)+this.data.alpha*Math.min(this.data.z_offset*(1-this.data.color_rgba.a)+this.data.color_rgba.a*h[6],h[6]),h[8]=this.data.alpha*Math.max((1-this.data.z_offset)*this.data.color_rgba.g*(1-this.data.color_rgba.a)+this.data.color_rgba.a*h[8],h[8]),h[12]=1*(1-this.data.alpha)+this.data.alpha*Math.min(this.data.z_offset*(1-this.data.color_rgba.a)+this.data.color_rgba.a*h[12],h[12]),h[13]=this.data.alpha*Math.max((1-this.data.z_offset)*this.data.color_rgba.b*(1-this.data.color_rgba.a)+this.data.color_rgba.a*h[13],h[13]),this.model.get("data").see_through&&(h[18]=this.data.z_offset))),this.data.filters[a].matrix=h,this.data.sprites[a].position={x:.5*this.data.stage_size.w,y:.5*this.data.stage_size.h},this.data.sprites[a].width=this.data.box_size,this.data.sprites[a].height=this.data.box_size,this.data.sprites[a].rotation=this.data.rotation*s+this.data.base_rotation,"xy"==this.data.direction)this.data.sprites[a].tileScale={x:o,y:o},this.data.sprites[a].tilePosition={x:.5*this.data.box_size*(1-o)+.5*(this.data.box_size-this.data.texture.width)*o+this.data.movement_offset.x*o+this.data.mouse_delta.smooth_cumu_x*o+this.data.scroll_position.x*o*.5,y:.5*this.data.box_size*(1-o)+.5*(this.data.box_size-this.data.texture.height)*o+this.data.movement_offset.y*o+this.data.mouse_delta.smooth_cumu_y*o+this.data.scroll_position.y*o*.5};else{var n=(this.data.z_offset,this.data.z_offset,d*o*(1-this.data.z_offset_exp)+o*this.data.z_offset_exp);this.data.sprites[a].tileScale={x:n*this.data.multiplier,y:n*this.data.multiplier},this.data.sprites[a].tilePosition={x:.5*this.data.box_size*(1-n*this.data.multiplier)+.5*(this.data.box_size-this.data.texture.width)*n*this.data.multiplier+this.data.scroll_position.x*n,y:.5*this.data.box_size*(1-n*this.data.multiplier)+.5*(this.data.box_size-this.data.texture.height)*n*this.data.multiplier+this.data.scroll_position.y*n}}if(0==a){var l=d*o;this.data.bg_sprite.position={x:.5*this.data.stage_size.w,y:.5*this.data.stage_size.h},this.data.bg_sprite.width=this.data.box_size,this.data.bg_sprite.height=this.data.box_size,this.data.bg_sprite.rotation=this.data.base_rotation+this.data.rotation,"xy"==this.data.direction?(this.data.bg_sprite.tilePosition=this.data.sprites[a].tilePosition,this.data.bg_sprite.tileScale=this.data.sprites[a].tileScale):(this.data.bg_sprite.tileScale={x:l*this.data.multiplier,y:l*this.data.multiplier},this.data.bg_sprite.tilePosition={x:.5*this.data.box_size*(1-l*this.data.multiplier)+.5*(this.data.box_size-this.data.texture.width)*l*this.data.multiplier+this.data.scroll_position.x*l+this.data.scroll_position.x*l,y:.5*this.data.box_size*(1-l*this.data.multiplier)+.5*(this.data.box_size-this.data.texture.height)*l*this.data.multiplier+this.data.scroll_position.y*l+this.data.scroll_position.y*l})}}}},changeBGColor:function(){this.model.get("data").see_through?this.data.color_sprite.renderable=!1:(this.data.color_sprite.renderable=!0,this.data.color_sprite.tint=this.model.get("data").hex_color.replace("#","0x"))},changeOverlayColor:function(){var t=Object.assign({},this.model.get("data"));t.hasOwnProperty("overlay_hex")&&-1!=t.overlay_hex.indexOf("#")&&(this.data.overlay_sprite.tint=t.overlay_hex.replace("#","0x"),t.overlay_alpha>0?(this.data.overlay_sprite.renderable=!0,this.data.overlay_sprite.alpha=t.overlay_alpha):this.data.overlay_sprite.renderable=!1)},updateMotion:function(){var t=this.model.get("data");if(0!=t.length){var a=t.speed,e=0;"xy"==t.movement_direction?(a/=10,1==this.data.mouse_override?e+=this.data.mouse_angle:e+=(t.xy_direction-t.base_rotation)*(Math.PI/180),this.data.model_speed={x:Math.cos(e)*a,y:Math.sin(e)*a},this.data.movement_offset={x:Math.cos(e)*a+this.data.movement_offset.x,y:Math.sin(e)*a+this.data.movement_offset.y}):(a/=5,1==this.data.mouse_override?this.data.mouse_angle>0&&this.data.mouse_angle<Math.PI||(a*=-1):"inwards"==t.z_direction&&(a*=-1),this.data.model_speed={x:0,y:a},this.data.movement_offset={x:0,y:a+this.data.movement_offset.y})}},updateScrollOffset:function(){var t=-$(window).scrollTop(),a=-$(window).scrollLeft();0!=t&&(this.data.scroll_position.y=t),0!=a&&(this.data.scroll_position.x=a)},updateMouseOffset:function(t){var a=this.model.get("data");if(a.mouse_interaction){var e=.01*a.mouse_speed;this.data.mouse_cur={x:0,y:0},this.data.is_mobile&&t?(this.data.mouse_cur={x:t.layerX||t.touches[0].clientX,y:t.layerY||t.touches[0].clientY},this.data.mouse_cur.x*=e,this.data.mouse_cur.y*=e):this.data.mouse_cur=t?{x:t.clientX*e,y:t.clientY*e}:{x:this.data.mouse_prev.x,y:this.data.mouse_prev.y},this.setMouseDelta(),this.data.mouse_calced=!0,this.data.mouse_prev={x:this.data.mouse_cur.x,y:this.data.mouse_cur.y}}},setMouseDelta:function(){var t=this.model.get("data");if(!(Math.abs(this.data.mouse_cur.x-this.data.mouse_prev.x)>200||Math.abs(this.data.mouse_cur.y-this.data.mouse_prev.y)>200)){var a=(t.mouse_speed,{x:this.data.mouse_cur.x-this.data.mouse_prev.x,y:this.data.mouse_cur.y-this.data.mouse_prev.y}),e=t.base_rotation*(Math.PI/180)*-1;if("xy"==t.movement_direction)var s=Math.atan2(a.y,a.x)+e;else var s=Math.atan2(a.y,a.x);var i=Math.sqrt(a.x*a.x+a.y*a.y);if(-1==this.data.mouse_prev.x||"undefined"===this.data.mouse_delta)this.data.mouse_delta={x:0,y:0,smooth_x:0,smooth_y:0,smooth_cumu_x:0,smooth_cumu_y:0};else{var r={x:this.data.mouse_delta.smooth_x,y:this.data.mouse_delta.smooth_y};this.data.mouse_delta={x:Math.cos(s)*i,y:Math.sin(s)*i,smooth_x:.1*this.data.mouse_delta.x+.9*r.x,smooth_y:.1*this.data.mouse_delta.y+.9*r.y,smooth_cumu_x:this.data.mouse_delta.smooth_cumu_x+this.data.mouse_delta.smooth_x,smooth_cumu_y:this.data.mouse_delta.smooth_cumu_y+this.data.mouse_delta.smooth_y}}Math.abs(this.data.mouse_delta.x)>Math.abs(this.data.model_speed.x)&&Math.abs(this.data.mouse_delta.y)>Math.abs(this.data.model_speed.y)&&(this.data.mouse_angle=s,this.data.mouse_override=!0)}},SetSizeFromMainView:function(t,a){if(this.data.window_width!=t||this.data.window_height!=a){this.data.window_height=a,this.data.window_width=t;var e=1;t<900?e=1.5:t<1280&&(e=1.25),this.data.multiple=e,this.data.stage_size.w=t*e,this.data.stage_size.h=a*e,this.queueResize=!0,this.setLayerData()}},Pause:function(){window.cancelAnimationFrame(this.drawFrameID),this.paused=!0},Resume:function(){window.cancelAnimationFrame(this.drawFrameID),this.in_viewport&&this.data.inited&&(this.draw(),this.paused=!1)},draw:function(){this.drawFrameID=window.requestAnimationFrame(this.draw),this.queueResize&&(this.data.renderer.resize(this.data.stage_size.w,this.data.stage_size.h),this.queueResize=!1),this.updateMotion(),0==this.data.mouse_calced&&this.setMouseDelta(),this.data.mouse_calced=!1,this.styleLayers(),this.data.renderer.render(this.data.stage)},Init:function(){this.data={cid:this.cid,multiple:1,renderTexture:null,renderer:null,stage:null,mask_stage:null,inited:!1,overlay_sprite:null,mask_attempts:0,masked_image_texture:null,is_mobile:!1,sprites:[],bg_sprite:null,texture:null,filters:[],image_loaded:!1,scroll_position:{x:0,y:0},stage_size:{w:800,h:600,resolution:1},movement_offset:{x:0,y:0},mouse_prev:{x:-1,y:-1},mouse_cur:{x:0,y:0},model_speed:{x:0,y:0},mouse_angle:0,mouse_override:!1,mouse_delta:{x:0,y:0,smooth_x:0,smooth_y:0,smooth_cumu_x:0,smooth_cumu_y:0},direction:0,depth:0,layers:1,rotation:0,base_rotation:0,color_rgba:{r:0,g:0,b:0,a:0},box_size:0,multiplier:0,z_offset:0,z_offset_exp:0};var t=this.model.get("data");this.backdropEl||(this.backdropEl=closest(this.el,function(t){if(t&&t.nodeType===Node.ELEMENT_NODE)return t.classList.contains("backdrop")})),this.data.renderer=new a.Renderer({width:1024,height:1024,resolution:1,transparent:t.see_through||Cargo.Helper.IsAdminEdit(),view:this.el.querySelector("canvas.parallax_canvas")}),this.model.get("data").see_through?this.el.classList.add("see-through"):this.el.classList.remove("see-through"),this.data.stage=new a.Container,this.data.mask_stage=new a.Container,void 0==t.image&&(t.image=this.defaults.image,this.model.set("data",t)),"xy"==t.movement_direction?this.data.layers=t.layers-1:this.data.layers=t.z_layers-1,this.makeSprites(),window.removeEventListener("scroll",this.updateScrollOffset),1==t.scroll_interaction&&window.addEventListener("scroll",this.updateScrollOffset),Cargo.Helper.isMobile()?(this.data.is_mobile=!0,window.removeEventListener("touchmove",this.updateMouseOffset),window.addEventListener("touchmove",this.updateMouseOffset)):(window.removeEventListener("mousemove",this.updateMouseOffset),window.addEventListener("mousemove",this.updateMouseOffset)),this.changeBGColor(),this.changeOverlayColor(),this.setLayerData(),this.loadImage()},Update:function(t,a){var e=this,s=Object.assign({},this.model.get("data")),i=s[t];if(s[t]=a,this.model.set("data",s),0!=this.data.inited&&i!=a){if("see_through"==t)return this.Pause(),cancelAnimationFrame(this.drawFrameID),this.data.image_loaded=!1,this.data.stage.removeChildren(),this.data.mask_stage.removeChildren(),this.data.renderTexture=null,this.data.stage=null,this.data.mask_stage=null,this.data.overlay_sprite=null,this.data.mask_attempts=0,this.data.masked_image_texture=null,this.data.is_mobile=!1,this.data.sprites=[],this.data.bg_sprite=null,this.data.texture=null,this.data.filters=[],this.data.image_loaded=!1,this.data.renderer.destroy(),this.data.renderer=null,this.data.layers=[],this.data.sprites=[],this.data.bg_sprite=null,this.data.inited=!1,this.queueResize=!0,void this.Init();"layers"!=t&&"movement_direction"!=t&&"z_layers"!=t||("xy"==s.movement_direction?e.data.layers=s.layers-1:e.data.layers=s.z_layers-1,e.data.stage.removeChildren(),e.makeSprites(),e.setLayerData()),"knockout"!=t&&"knockout_shape"!=t&&"knockout_blur"!=t&&"knockout_rotation"!=t||(this.data.image_loaded&&this.data.texture&&this.makeMask(),this.setLayerData()),"image"==t&&(i!=a&&(this.data.image_loaded=!1,this.loadImage()),this.setLayerData()),"image_delete"==t&&s.image==a&&(s.image="",this.model.set("data",s),this.data.image_loaded=!1,this.loadImage(),this.setLayerData()),"hex_color"==t&&(this.changeBGColor(),this.setLayerData()),"alpha"==t&&this.setLayerData(),"overlay_hex"!=t&&"overlay_alpha"!=t||(this.changeOverlayColor(),this.setLayerData()),"xy_direction"!=t&&"z_direction"!=t&&"speed"!=t&&"base_rotation"!=t&&"mouse_interaction"!=t||(this.data.mouse_override=!1,this.setLayerData()),"depth"!=t&&"skew"!=t||this.setLayerData(),"scroll_interaction"==t&&(this.data.scroll_position={x:0,y:0},window.removeEventListener("scroll",this.updateScrollOffset),1==a&&window.addEventListener("scroll",this.updateScrollOffset))}},destroy:function(){this.image_load_queue=[],window.cancelAnimationFrame(this.drawFrameID),window.removeEventListener("scroll",this.updateScrollOffset),window.removeEventListener("mousemove",this.updateMouseOffset),window.removeEventListener("touchmove",this.updateMouseOffset),this.Pause(),this.data.texture=null,this.data.stage=null,this.mask_stage=null,this.data.loader=null,this.data.renderer.destroy(),this.makeMask=null,this.loadImage=null,this.data=null,this.destroyed=!0}})}),Backdrop.Data.require_loaded=!0,function(t){var a=document,e="appendChild",s="styleSheet",i=a.createElement("style");i.type="text/css",a.getElementsByTagName("head")[0][e](i),i[s]?i[s].cssText=t:i[e](a.createTextNode(t))}('[data-backdrop="parallax"].backdrop > div {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\topacity: 0;\n}\n\n[data-backdrop="parallax"] .parallax_canvas {\n\tbackground-color: #000;\t\t\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0px;\n\twidth: 100%;\n\theight: 100%;\n}\n\n\n[data-backdrop="parallax"] .see-through .parallax_canvas{\n\tbackground-color: transparent;\t\n}');